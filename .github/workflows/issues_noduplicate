name: Check for duplicate issues
on:
  issues:
    types: [opened]
jobs:
  check:
    runs-on: ubuntu-latest
    env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      - name: Check for duplicate issues
        run: |
          title=$(jq --raw-output .issue.title "$GITHUB_EVENT_PATH")
          repo=$(jq --raw-output .repository.full_name "$GITHUB_EVENT_PATH")
          duplicate=$(gh issue list --state=all --label=duplicate --title="$title" | grep -o "$repo")
          if [[ -n "$duplicate" ]]; then
            echo "An issue with the same title already exists in $duplicate"
            exit 1
          fi
