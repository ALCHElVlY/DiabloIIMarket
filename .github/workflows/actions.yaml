name: Map Project Actions WorkFlow

on:
  issues:
    types: [opened]
  issue_comment:
    types: [created]
  pull_request:
    types: [opened]
  pull_request_review_comment:
    types: [created]

env:
  WORKFLOWS: |
    issues:
      file: "issues/issue_sync.yaml"
      types: ["opened"]
    issue_comment:
      file: "issues/issue_comment_sync.yaml"
      types: ["created"]
    pull_request:
      file: "pull-requests/pr_sync.yaml"
      types: ["opened"]
    pull_request_comment_create:
      file: "pull-requests/pr_comment_sync.yaml"
      types: ["created"]

jobs:
  choose_and_run:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        workflow: [$env.WORKFLOWS]
    steps:
      - name: Find matching workflow
        id: find_workflow
        run: |
          for key, value in ${{ fromJson(env.WORKFLOWS) }}.items():
            if contains(value.types, github.event_name):
              echo "::set-output name=file::${value.file}"
              echo "::set-output name=name::${key}"
              return 0
          return 1
      - name: Run workflow
        if: ${{ steps.find_workflow.outputs.file != null }}
        uses: ./${{ steps.find_workflow.outputs.file }}
